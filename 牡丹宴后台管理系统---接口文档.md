# 牡丹宴后台管理系统---接口文档

## 员工管理

### 员工资料查询

分页查询

请求方式：POST

请求路径：[localhost:8080/emp/list](http://localhost:8080/emp/list)

请求参数：

| 参数           | 是否必要 | 解释        |
| ------------ | ---- | --------- |
| pageSize     | 是    | 每页有多少条数据  |
| pageNo       | 是    | 从第几页开始    |
| name         | 否    | 模糊查询      |
| gender       | 否    | 性别精确查询    |
| departmentId | 否    | 根据部门来查询   |
| position     | 否    | 根据职位来查询   |
| status       | 否    | 根据在职状态来查询 |
| salary       | 否    | 根据薪资范围来查询 |

可以封装到一个Dto中    

返回数据：

不仅需要数据，还需要总记录条数。

可以封装成一个通用的类。

```java
@Data
public class PageVo<T> implements Serializable {
    T data;
    Long total;
    public PageVo(T data, Long total) {
        this.data = data;
        this.total = total;
    }
    public static <T> PageVo<T> Create(T data, Long total) {
        return new PageVo<>(data, total);
    }
}
```

例子：

```
请求体内容：

{
    "pageSize": "10",
    "pageNo": "1",
    "gender": "F",
    "fromSalary": "15000.00"
}


返回数据：
{
    "code": 200,
    "message": "操作成功",
    "data": {
        "data": [
            {
                "id": 2,
                "name": "李佳",
                "gender": "F",
                "phone": "13812345678",
                "departmentId": 1000,
                "position": "总经理",
                "hireDate": "2018-05-15T00:00:00",
                "salary": 35000.00,
                "status": 1,
                "leaveDate": null
            }
        ],
        "total": 1
    }
}
```

### 员工基本资料变更

现在你来看这个网页，我们的员工管理中细分了员工资料查询，员工薪资变更，员工职位调动，但是我觉得这三个著需要一个就行，就是员工资料查询，但是呢，员工薪资变更和员工只为调动又是比较特殊的更新，所以我希望你可以这样操作：第一：把员工薪资变更和员工职位调动删掉，然后在员工资料查询中加入三列，第一列是更改基本信息，第二列是更改薪资，第三列是职位调动，当然我只是给你个思路，你可以自由发挥，总之我们都是为项目服务，所以怎么好怎么来，对于第一列基本信息，后端需要以下数据，name,gender,phone,departmentId,status(这个是员工状态1表示在职0表示离职)，对于第二列，我们是更改薪资，你只需要给后端提交salary这个参数就行，就是新的薪资。第三列是职位调动，你需要提交position(一个数字)

position:
1->老板
2->总经理
3->部门经理
4->部门副经理
5->员工

对于以上变更，我们点击按钮之后需要后端回显数据，所以对于每个按钮，当你点击后都需要把id传给后端，然后拿到后端回显的数据展示在页面上

对于这三个回显，我们使用同一个接口：

请求方式：get请求路径 /data/{id}

后端返回数据

```
public class Employee {
    /**
     * 员工ID
     */
    @TableId(value = "id", type = IdType.AUTO)
    private Long id;

    /**
     * 员工姓名
     */
    @TableField(value = "name")
    private String name;

    /**
     * 性别（M/F）
     */
    @TableField(value = "gender")
    private String gender;

    /**
     * 电话
     */
    @TableField(value = "phone")
    private String phone;

    /**
     * 所属部门ID
     */
    @TableField(value = "department_id")
    private Long departmentId;

    /**
     * 职位（经理/副经理/员工等）
     */
    @TableField(value = "position")
    private Integer position;

    /**
     * 入职日期
     */
    @TableField(value = "hire_date")
    @DateTimeFormat(pattern = "yyyy-MM-ss HH:mm:ss")
    private LocalDateTime hireDate;

    /**
     * 工资
     */
    @TableField(value = "salary")
    private BigDecimal salary;

    /**
     * 状态（1在职，0离职）
     */
    @TableField(value = "status")
    private Integer status;

    /**
     * 解雇时间
     */
    @TableField(value = "leave_date")
    @DateTimeFormat(pattern = "yyyy-MM-ss HH:mm:ss")
    private LocalDateTime leaveDate;
}
```

对于每个回显，你只需要渲染你该渲染的内容即可。好了，先完成这些内容吧，至于更改数据，我们一会在说

### 员工薪资变更

员工薪资回显：

点击变更按钮发送请求回显当前员工员工的薪资

请求方式：GET

请求路径：emp/salary/?id=8

员工薪资变更

请求方式：PUT

请求路径：?id=8&salary=250

```
备注：
只能是级别高的人变更比自己级别低的人的薪资，而且最低级别是3
例如，3能改4，4不能改5，1能改2，3，4，5
但是1的薪资也要有人来改动，就只能是1吧。
```

### 员工职位调动

## 用户管理（注册登录）

### 注册

请求方式：POST

请求路径：/user/register

请求体：

```
Json数据：
包含：
name:
username:
gender:
phone:
position:
password:
definedPassword:
```

后端无需返回数据。

### 登录

请求方式：POST

请求路径：/user/login

请求体：

```
Json数据
包含：
username:
password:
```

返回数据：

Jwt令牌，包含用户id

注意事项：前端要拿到Jwt令牌并将其保存下来，在后续的请求中携带

```
Keys.secretKeyFor(SignatureAlgorithm.HS256);
```

### 退出登录

请求方式：GET

请求路径：/user/logout

前端将请求头中的jwt令牌删掉并路由值登录界面即可

### 修改信息

描述：此接口用来修改登录用户信息，具体实现方式是，在layout布局页面上，点击用户的username，就会出现另一个界面，这个界面加载时会调用钩子函数，发送请求如下：

请求方式：get

请求路径：/user/getinfo/?id=8

这是用来回显当前用户的信息，下面是一个返回内容：

```json
{
    "code": 200,
    "message": "操作成功",
    "data": {
        "id": 8,
        "name": "郭嘉庆",
        "username": "91guojiaqing",
        "gender": "男",
        "position": 5,
        "phone": "250",
        "password": null,
        "definedPassword": null
    }
}
```

需要回显的内容是：name,username,gender,position,phone这些内容，password，definedPassword没用，如果说我给你回显的内容有null,或者空值，回显就是空值。

以上就是数据回显。只需要回显name,username,gender,position,phone。也就是说，这个界面只能修改这些数据。

当确定好后有一个“确定更新”按钮，按下后你需要在前端检查数据是否合法，检查规则如下：

name只能是汉字，长度为2-4，username只能是字母数组和特殊符号，gender要么是男，要么是女

position:
1->老板
2->总经理
3->部门经理
4->部门副经理
5->员工

你要提供下拉选项框，指定这五个职位，但是如果是发送请求的话还是要发送数字给后端，然后呢下面是三个按钮，分别是：修改密码，保存，取消

会将新数据发送到后端，这时发送的请求是：

/user/update/?id=8

请求方式：PUT

请求方式：POST

请求路径：/user/login

请求体：

```
Json数据
修改前的密码：oldpassword
修改后的密码：newpassword
```

修改成功后，进行退出登录操作，让用户重新登录。

# 数据库字段说明

```
position:
1->老板
2->总经理
3->部门经理
4->部门副经理
5->员工


dish_type` int NOT NULL COMMENT '菜品类型：1=凉菜，2=热菜，3=面点，4=水果，5=饮品，6=其他',
status` int NOT NULL DEFAULT '1' COMMENT '状态：1=上架，0=下架',
unite:1=份，2=个，3=瓶


CREATE TABLE `t_orders` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '订单ID，主键',
  `room_id` int NOT NULL COMMENT '房间号',
  `order_type` int default 1 COMMENT '订单类型：1=单点，2=婚宴',
  `pay_method` int COMMENT '支付方式：1=微信，2=支付宝，3=刷卡',
  `discount_amount` decimal(10,2) DEFAULT '0.00' COMMENT '优惠金额',
  `extra_payment` decimal(10,2) DEFAULT '0.00' COMMENT '额外支付金额（打碎餐具等）',
  `pay_amount` decimal(10,2) DEFAULT '0.00' COMMENT '实际支付金额（顾客实付）',
  `total_amount` decimal(10,2) DEFAULT '0.00' COMMENT '应付总金额',
  `pay_time` datetime DEFAULT NULL COMMENT '结算时间',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注信息',
  `status` int DEFAULT 2 COMMENT '支付状态:1=已支付，2=未支付，3取消订单',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='订单表（记录餐厅订单信息）'
```

创建订单接口：

当服务员点击创建订单后，会发送如下请求：

请求方式：post

路径：localhost:8080/order/createOrder

前端必须要传的参数：

```
roomId:房间号 int类型如 302
```

后端创建订单，返回数据如下：

```
id：订单号
status`:int DEFAULT 2 COMMENT '支付状态:1=已支付，2=未支付，3取消订单',
```

前端将数据渲染到页面上。

点击开始点菜按钮后，进入点菜界面，点菜界面不是很完善，你要加入三列数据

第一列就是数量，这个表示当前菜品点了几份，默认是0，并且这个是有范围的，在0-100这个范围，不能超出，并且最好是通过按钮控制加减，而非手动输入。

第二列就是菜品备注，5个选项，不要葱，不要姜，不要蒜，不要辣，不要香菜，我不管你怎么做，反正要可以多选，还要好看，还能方便的传给后端。

第三列就是确认点菜，点击这个按钮后会发送如下请求：

请求方式：post

请求路径:/orderdetail/join

请求体：

```
Long orderId;
private Integer roomId;
private Integer dishId;
private String dishName;
private Integer amount;
/**
     * 是否为赠品或赔偿品：0=否，1=是
     */
    @TableField(value = "is_gift_or_compensation")
    private Integer isGiftOrCompensation;
备注信息（不要葱姜蒜等内容）
private String remark;选择多个前端进行拼接
```

后端不需要返回数据。返回状态码即可。

然后呢，这个按钮点击后会变为取消点菜，用于客户不想要的情况。

发送如下请求

方式：delete

路径：/orderdetail/deleteinfo

携带请求体：

```
oderId:
roomId:
dishId:
```

用户删除订单明细表中的数据，后端不需要返回数据，前端继续回复按钮状态。

但是这个界面需要增加一个按钮，就是客人点餐完毕后服务员按下，这个按钮叫做：起菜

我们的点餐界面需要换一下，我们现在的逻辑是点击开始后，会出现菜单，然后选择某个菜，点击确认点菜后就直接下单了，但是这样其实不是很优雅，我希望有一个叫做查看菜单的按钮，当点击这个按钮时，会出现所有的你所点击的菜，这样很直观也很优雅，如果点击确认点菜后有个什么动效或者动画啥的进入这个确认点菜按钮就更好了，这个你自己来把握，就想加入购物车那样的动效，当然做不到也可以不用做。点击查看菜单后会发送如下请求：

方式：Get

路径:/orderdetail/view/dishes

携带请求参数订单id

后端返回数据如下：

```
{
    "code": 200,
    "message": "操作成功",
    "data": [
        {
            "id": null,
            "orderId": 12,
            "roomId": 203,
            "dishId": null,
            "dishName": "凉拌黄瓜",
            "amount": 1,
            "isGiftOrCompensation": 0,
            "remark": ""
        },
        {
            "id": null,
            "orderId": 12,
            "roomId": 203,
            "dishId": null,
            "dishName": "拍黄瓜",
            "amount": 3,
            "isGiftOrCompensation": 0,
            "remark": "不要葱，不要蒜"
        }
    ]
}
```

你不需要渲染id和dishId,其他的都需要渲染，

isGiftOrCompensation=0便是不是赠送的，1表示是赠送的菜，好了，这个按钮写在哪里你自己来把握，我的后端已经写好了，就等你了

最后我们还需要加上一个按钮，就是“物品损坏/丢失”，这是为了应对客人不小心毁坏餐具或者打碎参加的情况，点击后就和查看菜单那样出现一个弹窗，需要房间号和订单后，这两个内容，你要自己填，后端不会给你回显，然后就是下拉框，有5个内容，分别是，杯子，勺子，盘子，其他，后面要有数量，表示损坏的数量，还需要新增，因为可能，不知毁坏了一种东西，可能有两种，因此点击新增就可以应对这种情况，好了，就这么多

这个界面你做的不是很好啊，房间号和订单号做的很不错，就是损坏物品这个做的不是很好，删除按钮都到数量里面了，而且加减按钮也不能用，我希望是这样的效果：

+[]-删除 新增

其中这里面的数字只能通过加减来控制，不可以手动输入，并且数量再1-10之间

最后为什么没有备注？我们需要备注这个东西

点击提交后发送如下请求：

方式：Post

路径：/item/damage/add

请求体携带数据:

```
roomId:
orderId:
damageType:
amount:
remark:
```

你要注意的是，新增按钮可能被点击，也就是说你可能要发送好几次请求，也可能只有一次，就是看损坏了几种类型的物品。

后端返回数据如下：

```
{
    "code": 200,
    "message": "操作成功",
    "data": null
}
```

最后我们来完善确认订单这个按钮，事实上，我们不应该叫做确认订单，而应该叫做发送订单，这个订单会发送到

## 注册界面完善

需要如下字段：

string name,表示注册人的真实名字

string username,表示注册人的用户名

string gender,传入男或者女

Integer position;1-5分别表示5个等级

position:
1->老板
2->总经理
3->部门经理
4->部门副经理
5->员工

你只需要返回数字就行了

String phone;手机号

String password;密码

String definedPassword；确认密码

这些数据都需要传递，不能为空。
