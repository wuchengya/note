# 仓库仓位接口文档

## 仓库接口文档

对仓库的操作都写在一个controller中，因此公用一个前缀/store/warehouse。

### 仓库分页查询

请求方式：Post

请求路径：/list

前端应携带参数如下所示：

| 参数名称     | 解释            | 是否必要 | 参数类型   |
|:--------:|:-------------:|:----:|:------:|
| pageNo   | 从第几页开始？默认为1   | 否    | int    |
| pageSize | 每页多少条数据？默认为10 | 否    | int    |
| name     | 仓库名字          | 否    | String |
| status   | 仓库状态          | 否    | int    |
| address  | 仓库地址          | 否    | String |

后端返回参数如下：

```json
{
  "success": true,
  "message": "success",
  "code": 200,
  "timestamp": 1715678901234,
  "result": {
    "total": 42,
    "rows": [
      {
        "id": "1789001", 
        "createTime": "2023-11-10 10:00:00",
        "updateTime": "2023-12-01 14:20:00",
        "createBy": "admin",
        "updateBy": "admin",
        "name": "京东华东一号智能仓",
        "x": 121.5678,
        "y": 31.2345,
        "size": 50000.0,
        "description": "主要存储3C电子产品，配备全自动分拣机器人",
        "status": 2,
        "address": "上海市浦东新区张江高科园区88号"
      },
      {
        "id": "1789002",
        "createTime": "2024-01-15 09:30:00",
        "updateTime": "2024-02-20 16:45:00",
        "createBy": "manager_li",
        "updateBy": "manager_li",
        "name": "顺丰北京顺义冷链仓",
        "x": 116.6543,
        "y": 40.1234,
        "size": 25000.5,
        "description": "恒温冷库，用于存储生鲜食品和药品",
        "status": 3,
        "address": "北京市顺义区空港物流园6号路"
      },
      {
        "id": "1789003",
        "createTime": "2023-05-20 11:11:00",
        "updateTime": "2023-06-01 08:00:00",
        "createBy": "system",
        "updateBy": "system",
        "name": "广州天河中转仓",
        "x": 113.3611,
        "y": 23.1248,
        "size": 12000.0,
        "description": "负责广州市区的小件包裹中转",
        "status": 1,
        "address": "广东省广州市天河区科韵路12号"
      }
    ],
    "pageNum": 1,
    "pageSize": 10,
    "totalPage": 5
  }
}
```

### 查询仓库

请求方式：Get

请求路径：?id=(路径参数，拼接id)

前端应携带参数如下所示：

| 参数名称 | 解释   | 是否必要 | 参数类型   |
|:----:|:----:|:----:|:------:|
| id   | 仓库id | 是    | String |

返回数据如下：

```json
{
  "success": true,
  "message": "success",
  "code": 200,
  "timestamp": 1715679001234,
  "result": {
    "id": "1789001",
    "createTime": "2023-11-10 10:00:00",
    "updateTime": "2023-12-01 14:20:00",
    "createBy": "admin",
    "updateBy": "admin",
    "name": "京东华东一号智能仓",
    "x": 121.5678,
    "y": 31.2345,
    "size": 50000.0,
    "description": "主要存储3C电子产品，配备全自动分拣机器人",
    "status": 2,
    "address": "上海市浦东新区张江高科园区88号",
    "delFlag": 0
  }
}
```

### 新增仓库

请求方式：Post

请求路径：

前端应携带参数如下所示：

| 参数名字        | 解释                | 是否必要 | 参数类型   |
|:-----------:|:-----------------:|:----:|:------:|
| name        | 仓库名字              | 是    | String |
| x           | 经度                | 是    | Double |
| y           | 纬度                | 是    | Double |
| size        | 仓库大小/尺寸(平方千米)     | 是    | Double |
| description | 仓库的描述             | 是    | String |
| status      | 仓库状态/0禁用/1正常/2/饱满 | 是    | int    |
| address     | 仓库位置              | 是    | String |

返回数据如下：

```json
{
  "success": true,
  "message": "success",
  "code": 200,
  "timestamp": 1715679005678,
  "result": null
}
```

### 修改仓库

请求方式：Put

请求路径：

前端应携带参数如下所示：

| 参数名字        | 解释                | 是否必要 | 参数类型   |
|:-----------:|:-----------------:|:----:|:------:|
| id          | 仓库id              | 是    | String |
| name        | 仓库名字              | 否    | String |
| x           | 经度                | 否    | Double |
| y           | 纬度                | 否    | Double |
| size        | 仓库大小/尺寸           | 否    | Double |
| description | 仓库的描述             | 否    | String |
| status      | 仓库状态/0禁用/1正常/3/饱满 | 否    | int    |
| address     | 仓库位置              | 否    | String |

返回数据如下：

```json
{
  "success": true,
  "message": "success",
  "code": 200,
  "timestamp": 1715679009876,
  "result": null
}
```

### 删除仓库

请求方式：Delete

请求路径：

前端应携带参数如下所示：

| 参数名称 | 解释   | 是否必要 | 参数类型   |
|:----:|:----:|:----:|:------:|
| id   | 仓库id | 是    | String |

返回数据如下：

```json
{
  "success": true,
  "message": "success",
  "code": 200,
  "timestamp": 1715679012345,
  "result": null
}
```

### 导出仓库Excel

请求方式：Get

请求路径：/export

前端无需传递任何参数，但是发请求有特定说法。导出采用阿里easyExcel，后端代码如下：

```java
@GetMapping("/export")
public ResultMessage<Object> export(HttpServletResponse response) throws IOException {
    warehouseService.export(response);
    return ResultUtil.success();
}
@Override
public void export(HttpServletResponse response) throws IOException {
    response.setContentType("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");
    response.setCharacterEncoding("utf-8");
    response.setHeader("Content-disposition", "attachment;filename=user.xlsx");

    // 真实业务实体
    List<Warehouse> warehouses = list();

    // 转换成导出 VO
    List<WarehouseExportVo> exportList = warehouses.stream()
            .map(u -> {
                WarehouseExportVo vo = new WarehouseExportVo();
                vo.setWarehouseId(u.getId());
                vo.setName(u.getName());
                vo.setDescription(u.getDescription());
                vo.setStatus(u.getStatus());
                vo.setAddress(u.getAddress());
                return vo;
            }).toList();

    // 导出
    EasyExcel.write(response.getOutputStream(), WarehouseExportVo.class)
            .sheet("仓库数据")
            .doWrite(exportList);
}
```

根据后端代码问AI如何写前端。

### 2.7 导出仓位数据 (Excel)

```java
//后端代码如下：
@RequestMapping("manager/warehouse/address")

@GetMapping("/export")
public ResultMessage<Object> export(HttpServletResponse response,@RequestBody WarehouseAddressPageDto warehouseAddressPageDto) throws IOException {

    warehouseAddressService.export(response,warehouseAddressPageDto);
    return ResultUtil.success();
}
    @Override
    public void export(HttpServletResponse response, WarehouseAddressPageDto warehouseAddressPageDto) throws IOException {
        if (warehouseAddressPageDto == null) {
            log.warn("仓位导出Excel失败");
            return;
        }
        response.setContentType("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");
        response.setCharacterEncoding("utf-8");
        response.setHeader("Content-disposition", "attachment;filename=user.xlsx");

        PageResult<WarehouseAddress> pageList = pageList(warehouseAddressPageDto);
        List<WarehouseAddress> warehouseAddressList = pageList.getRows();

        List<WarehouseAddressExportVo> list = warehouseAddressList.stream().map(warehouseAddress1 -> {
            WarehouseAddressExportVo warehouseAddressExportVo = new WarehouseAddressExportVo();
            warehouseAddressExportVo.setWarehouseId(warehouseAddress1.getWarehouseId());
            warehouseAddressExportVo.setValue(warehouseAddress1.getValue());
            warehouseAddressExportVo.setStatus(warehouseAddress1.getStatus());
            return warehouseAddressExportVo;
        }).toList();

        EasyExcel.write(response.getOutputStream(), WarehouseAddressExportVo.class)
                .sheet("仓位数据")
                .doWrite(list);
    }
```
